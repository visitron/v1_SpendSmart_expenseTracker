<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SpendSmart - Dashboard</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container mt-4">

    <!-- Header with greeting and logout -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>Dashboard</h1>
      <div>
        <span class="me-2">üëã Hello, <strong><%= user.full_name %></strong></span>
        <a href="/logout" class="btn btn-outline-danger btn-sm">Logout</a>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card text-white bg-success">
          <div class="card-body">
            <h5 class="card-title">Total Income</h5>
            <p class="card-text fs-4">‚Çπ <%= (summary.income || 0).toFixed(2) %></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-white bg-danger">
          <div class="card-body">
            <h5 class="card-title">Total Expense</h5>
            <p class="card-text fs-4">‚Çπ <%= (summary.expense || 0).toFixed(2) %></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-white bg-primary">
          <div class="card-body">
            <h5 class="card-title">Balance</h5>
            <p class="card-text fs-4">‚Çπ <%= (summary.balance || 0).toFixed(2) %></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Income vs Expense</h5>
        <canvas id="summaryChart" height="100"></canvas>
      </div>
    </div>

    <!-- summary -->
      <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">üîç Smart Summary</h5>
        <div style="white-space: pre-line;">
          <%= summaryText %>
        </div>
      </div>
    </div>


    <!-- Add Transaction Button -->
    <a href="/add" class="btn btn-success mb-3">+ Add Transaction</a>

    <!-- Transactions Table -->
    <h2 class="mb-3">All Transactions</h2>
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Amount</th>
          <th>Type</th>
          <th>Description</th>
          <th>Category</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% transactions.forEach(tx => { %>
          <tr>
            <td>‚Çπ<%= tx.amount %></td>
            <td><%= tx.transaction_type %></td>
            <td><%= tx.description %></td>
            <td><%= tx.category_name || 'N/A' %></td>
            <td><%= new Date(tx.transaction_time).toLocaleString() %></td>
            <td>
              <a href="/edit/<%= tx.id %>" class="btn btn-sm btn-primary">Edit</a>
              <form action="/delete/<%= tx.id %>" method="POST" style="display:inline;">
                <button class="btn btn-sm btn-danger" onclick="return confirm('Delete this transaction?')">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Chart.js Script -->
  <script>
    const ctx = document.getElementById('summaryChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Income', 'Expense'],
        datasets: [{
          label: '‚Çπ Amount',
          data: [<%= summary.income || 0 %>, <%= summary.expense || 0 %>],
          backgroundColor: ['#28a745', '#dc3545'],
          borderWidth: 1
        }]
      },
      options: {
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
  </script>
</body>
</html>
